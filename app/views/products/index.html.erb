
<!-- Script required for Google Maps API -->
<script src="//maps.google.com/maps/api/js?key="ENV['GMAPS_API']""></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->

<div class= "product-all">
  <div class ="container">
    <div class= "row">
      <div class= "col s12">
        <p id="notice"><%= notice %></p>
        <p><%= current_user.username %>, <%= current_user.email %></p>
        <div class= "card intro-card">
          <p>Welcome to <span class= "bold">Hamper!</span></p>
          <i class= "material-icons icon-size-md">person</i>
          <i class= "material-icons icon-size-sm">pages</i>
          <i class= "material-icons icon-size-md">compare_arrows</i>
          <i class= "material-icons icon-size-sm">local_atm</i>
          <i class= "material-icons icon-size-md">person</i>
          <p>Buy and sell cheap hampers packed with extra pantry items or veggies!</p>
        </div>
      </div> <!-- col end  -->
    </div> <!-- row end  -->
    <p>Sort by:
      <%= link_to "Created at", products_path(order: 'created_at'), 'data-no-turbolink' => true %>,
      <%= link_to "cost", products_path(order: 'cost'), 'data-no-turbolink' => true %>,
      <%= link_to "contents", products_path(order: 'contents'), 'data-no-turbolink' => true %> <!-- temporary. change for user.location -->
    </p>
    <hr>
  </div>


      <% @products.each do |product| %>
        <% if product.purchased == false%>
          <div class="row">
            <div class="col s12 m7">
              <div class="card">
                <div class= "card-content">
                  <div class= "row">
                    <div class= "col s3">
                      <img src="<%= product.user.avatar.url %>" alt="" class="circle responsive-img">
                    </div>
                    <div class= "col s6">
                      <p><%= product.title %></p>
                      <p><%= link_to product.user.username, product.user %> <%= rating_for product.user, 'selling'%></p>
                    </div>
                    <div class= "col s3">
                      <p><%= number_to_currency(product.cost) %></p>
                    </div>
                  </div>
                </div>
                <div class="card-image">
                  <img class= "resize-img" src="<%= product.images[0].url %>">
                </div>
                <div class="card-content">
                  <p><%= product.contents %></p>
                </div>
                <div class="card-action">
                  <p><%= link_to 'View', product %> <%= product.user.location %> </p>
                </div>
              </div>
            </div>
          </div>
          <% else %>
        <% end %>
      <% end %>




    <h1>Products</h1>

    <table>
      <thead>
        <tr>
          <th>Title</th>
          <th>User</th>
          <th>Location</th>
          <th>Cost</th>
          <th>Collection</th>
          <th>Items</th>
          <th>Contents</th>
          <th>Perishables</th>
          <th>Non perishables</th>
          <th>Description</th>
          <th colspan="3"></th>
        </tr>
      </thead>


      <tbody>
        <% @products.each do |product| %>
            <tr>
              <td><%= product.title %></td>
              <td><%= link_to product.user.username, product.user %></td>
              <td><%= product.user.location %></td>
              <td><%= number_to_currency(product.cost) %></td>
              <td><%= product.collection %></td>
              <td><%= product.items %></td>
              <td><%= product.contents %></td>
              <td><%= true_false(product.perishables) %></td>
              <td><%= true_false(product.non_perishables) %></td>
              <td><%= product.description %></td>
              <td><%= link_to 'Show', product %></td>
              <td><%= link_to 'Edit', edit_product_path(product) %></td>
              <td><%= link_to 'Destroy', product, method: :delete, data: { confirm: 'Are you sure?' } %></td>
            </tr>
        <% end %>
      </tbody>
    </table>

    <br>
    <%= form_tag products_path, :method => 'get' do %>
      <p>
        <%= text_field_tag :search, params[:search] %>
        <%= submit_tag "Search", :name => nil %>
      </p>
    <% end %>
    <br>

    <!-- Sorts by filters. passes in order: string as params that activates if statements in controller  -->
    <p>Sort by:
      <%= link_to "Created at", products_path(order: 'created_at') %>,
      <%= link_to "cost", products_path(order: 'cost') %>,
      <%= link_to "contents", products_path(order: 'contents') %> <!-- temporary. change for user.location -->
    </p>

    <!-- Google Maps Display -->
    <div>
      <div id="map" style='height: 400px;'></div>
    </div>
    <script type='text/javascript'>
      handler = Gmaps.build('Google');
      handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
        markers = handler.addMarkers(<%=raw @hash.to_json %>);
        handler.bounds.extendWith(markers);
        handler.fitMapToBounds();
      });
    </script>
</div>
